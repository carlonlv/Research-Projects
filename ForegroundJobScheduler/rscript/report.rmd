---
title: "report"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("xlsx")
library("readxl")
library("ggplot2")
library("dplyr")
library("gridExtra")
library("pracma")
library("forecast")
library("mvtnorm")
library("arules")
library("dict")
library("cluster")
library("xlsx")
library("knitr")
library("kableExtra")
```


```{r, echo=FALSE}
make_fitted_model_plot <- function(dataset, lm) {
  predicted <- predict(lm, newdata=data.frame(bin=linspace(min(dataset$bin), max(dataset$bin), 100)))
  predicted_df <- data.frame(x=linspace(min(dataset$bin), max(dataset$bin), 100), y=predicted)
  plt <- ggplot() +
    geom_point(aes(x=bin, y=sd), dataset) +
    geom_line(aes(x=x, y=y), predicted_df) +
    ylab("Maxes") +
    xlab("Bin")
  return(plt)
}


make_qqnorm_plot <- function(dataset) {
  df <- dataset %>%
    group_by(bin) %>%
    count()
  binnum <- df$bin[df$n == max(df$n)]
  df <- dataset %>%
    filter(bin == binnum)
  plt <- ggplot(df, aes(sample = max)) +
    stat_qq() +
    stat_qq_line()
  return(plt)
}


make_hist <-  function(dataset) {
  breaks <- seq(0, 50, 10)
  dataset$hst <- NA
  for (i in 1:nrow(dataset)) {
    j = 1
    current_bin <- dataset[i, ]$bin
    while (j <= (length(breaks) - 1)) {
      if (current_bin <= breaks[j+1]) {
        break
      }
      j <- j + 1
    }
    dataset[i, ]$hst <- paste("From", breaks[j], "To", breaks[j+1])
  }
  plt <- ggplot(dataset, aes(x=max, color=hst, alpha=0.5)) + 
    geom_histogram(bins=20, fill="white", show.legend = FALSE) + 
    xlab("Maxes") +
    ylab("Frequency")
  return(plt)
}


plot_results <- function(model_results, sample_size, window_size, model_name=c("AR1", "VAR1", "AR1_logistic_glm", "AR1_logistic_lm", "AR1_state_based_logistic", "AR1_Markov", "Markov")) {
  model_results <- model_results %>% 
    filter(Sample.Size== sample_size & Window.Size == window_size & Model %in% model_name) %>%
    filter(!is.na(Avg.Cycle.Usage1) & !is.na(Avg.Cycle.Usage2) & !is.na(Survival.Rate) & !is.na(Correctly.Scheduled) & !is.na(Correctly.Unscheduled))
  plt1 <- ggplot(model_results, aes(x=Survival.Rate, y=Avg.Cycle.Usage1)) +
      geom_point(na.rm=TRUE, aes(color=factor(Model), size=factor(StateNum), alpha=factor(Granularity), shape=factor(BinNum))) + 
      geom_vline(xintercept=0.99, linetype="dashed", color="red") + 
      ylab("Utilization") +
      xlab("Survival Rate") + 
      ggtitle(paste("Model Performance With Sample Size", sample_size, "and Window Size", window_size))
  plt2 <- ggplot(model_results, aes(x=Survival.Rate, y=Avg.Cycle.Usage2)) +
      geom_point(na.rm=TRUE, aes(color=factor(Model), size=factor(StateNum), alpha=factor(Granularity), shape=factor(BinNum))) + 
      geom_vline(xintercept=0.99, linetype="dashed", color="red") + 
      ylab("Utilization") +
      xlab("Survival Rate") + 
      ggtitle(paste("Model Performance With Sample Size", sample_size, "and Window Size", window_size))
  print(plt1)
  print(plt2)
}
```


## Overall Performance

```{r echo=FALSE}
sample_size <- 100
window_size <- 12

if (Sys.info()["sysname"] == "Windows") {
  ar_data_path <- "C://Users//carlo//Documents//GitHub//Research-Projects//ForegroundJobScheduler//results//Nonoverlapping windows//summary dynamic (windows,granularity).xlsx"
} else {
  ar_data_path <- "/Users/carlonlv/Documents/Github/Research-Projects/ForegroundJobScheduler/results/Nonoverlapping windows/summary dynamic (windows,granularity).xlsx"
}

ar_xlsx <- read.xlsx(ar_data_path, sheetIndex = 1)
plot_results(ar_xlsx, sample_size, window_size, c("AR1", "VAR1", "AR1_logistic_glm", "AR1_logistic_lm", "AR1_Markov"))
```

```{r echo=FALSE}
sample_size <- 100
window_size <- 12

if (Sys.info()["sysname"] == "Windows") {
  ar_data_path <- "C://Users//carlo//Documents//GitHub//Research-Projects//ForegroundJobScheduler//results//Nonoverlapping windows//summary dynamic (windows,granularity) post adj.xlsx"
} else {
  ar_data_path <- "/Users/carlonlv/Documents/Github/Research-Projects/ForegroundJobScheduler/results/Nonoverlapping windows/summary dynamic (windows,granularity) post adj.xlsx"
}

ar_xlsx <- read.xlsx(ar_data_path, sheetIndex = 1)
plot_results(ar_xlsx, sample_size, window_size, c("AR1", "VAR1", "AR1_logistic_glm", "AR1_logistic_lm", "AR1_Markov"))
```

```{r}
sample_size <- 100
window_size <- 12

if (Sys.info()["sysname"] == "Windows") {
  ar_data_path <- "C://Users//carlo//Documents//GitHub//Research-Projects//ForegroundJobScheduler//results//Nonoverlapping windows//summary dynamic (windows,granularity).xlsx"
} else {
  ar_data_path <- "/Users/carlonlv/Documents/Github/Research-Projects/ForegroundJobScheduler/results/Nonoverlapping windows/summary dynamic (windows,granularity).xlsx"
}

ar_xlsx <- read.xlsx(ar_data_path, sheetIndex = 1)
plot_results(ar_xlsx, sample_size, window_size, c("AR1", "VAR1", "AR1_Markov"))
```

```{r}
sample_size <- 100
window_size <- 12

if (Sys.info()["sysname"] == "Windows") {
  ar_data_path <- "C://Users//carlo//Documents//GitHub//Research-Projects//ForegroundJobScheduler//results//Nonoverlapping windows//summary dynamic (windows,granularity) post adj.xlsx"
} else {
  ar_data_path <- "/Users/carlonlv/Documents/Github/Research-Projects/ForegroundJobScheduler/results/Nonoverlapping windows/summary dynamic (windows,granularity) post adj.xlsx"
}

ar_xlsx <- read.xlsx(ar_data_path, sheetIndex = 1)
plot_results(ar_xlsx, sample_size, window_size, c("AR1", "VAR1", "AR1_Markov"))
```
